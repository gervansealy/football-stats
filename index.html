<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Season Player Database</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="firebase-loading" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
        <div style="text-align: center; color: white;">
            <h2>üî• Connecting to Firebase...</h2>
            <p>Please wait a moment</p>
        </div>
    </div>

    <div id="permission-modal" class="modal active">
        <div class="modal-content permission-modal-content">
            <h2>Access Football Database</h2>
            <p>Select your role and enter the password</p>
            <div class="permission-form">
                <div class="permission-buttons">
                    <button class="permission-btn admin-btn" onclick="database.selectRole('admin')">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                        </svg>
                        <h3>Admin</h3>
                        <p>Full control + manage passwords</p>
                    </button>
                    <button class="permission-btn editor-btn" onclick="database.selectRole('editor')">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                        <h3>Editor</h3>
                        <p>Add, edit, and delete data</p>
                    </button>
                    <button class="permission-btn viewer-btn" onclick="database.selectRole('viewer')">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                        </svg>
                        <h3>Viewer</h3>
                        <p>View-only access</p>
                    </button>
                </div>
                <div id="password-input-container" class="password-input-container" style="display: none;">
                    <label for="role-password">Enter Password:</label>
                    <input type="password" id="role-password" placeholder="Password">
                    <div class="password-actions">
                        <button class="btn-primary" onclick="database.verifyPassword()">Access Database</button>
                        <button class="btn-secondary" onclick="database.cancelPasswordInput()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-settings-modal" class="modal">
        <div class="modal-content permission-modal-content">
            <span class="close" onclick="database.closeAdminSettings()">&times;</span>
            <h2>Admin Settings - Change Passwords</h2>
            <p>Only admins can change access passwords</p>
            <div class="admin-settings-form">
                <div class="form-group">
                    <label>Admin Password:</label>
                    <input type="password" id="admin-password" placeholder="Enter new admin password">
                    <small>Required for admin access</small>
                </div>
                <div class="form-group">
                    <label>Editor Password:</label>
                    <input type="password" id="editor-password" placeholder="Enter new editor password">
                    <small>Required for editor access</small>
                </div>
                <p style="margin-top: 15px; color: #7f8c8d; font-size: 0.9em;">
                    <strong>Note:</strong> Viewers do not require a password.
                </p>
                <button class="btn-primary" onclick="database.saveAccessPasswords()">Update Passwords</button>
            </div>
        </div>
    </div>

    <header>
        <h1>Football Season Player Database</h1>
        <div class="header-controls">
            <nav>
                <button class="nav-btn active" data-section="standings">Standings</button>
                <button class="nav-btn" data-section="input" id="nav-input">Input Stats</button>
                <button class="nav-btn" data-section="profiles">Player Profiles</button>
                <button class="nav-btn" data-section="settings" id="nav-settings">Settings</button>
            </nav>
            <div class="permission-indicator">
                <span id="current-role"></span>
                <button class="btn-small" onclick="database.changePermission()">Change Role</button>
            </div>
        </div>
    </header>

    <main>
        <!-- Section 1: Standings -->
        <section id="standings" class="section active">
            <div class="section-header">
                <h2>Season Standings</h2>
                <div class="year-filter">
                    <label>Year:</label>
                    <select id="year-filter">
                    </select>
                </div>
            </div>
            <div class="table-container">
                <table id="standings-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player Name</th>
                            <th>Games</th>
                            <th>Wins</th>
                            <th>Draws</th>
                            <th>Losses</th>
                            <th>Clean Sheets</th>
                            <th>Goals</th>
                            <th>Capt. Wins</th>
                            <th>Capt. Losses</th>
                            <th>W:L Ratio</th>
                            <th>Win %</th>
                            <th>Points</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Input Stats Section -->
        <section id="input" class="section">
            <div class="section-header">
                <div class="section-tabs">
                    <button class="tab-btn active" data-tab="input-stats">Input Stats</button>
                    <button class="tab-btn" data-tab="game-history">Game History</button>
                </div>
                <div class="year-filter" id="input-year-filter-container" style="display: none;">
                    <label>Year:</label>
                    <select id="year-filter-input">
                    </select>
                </div>
            </div>

            <div id="input-stats" class="tab-content active">
                <h2>Input Game Stats</h2>
                <div class="game-date-container">
                    <label for="game-date">Game Date:</label>
                    <input type="date" id="game-date" required>
                </div>
                <div class="bulk-input-container">
                    <div id="bulk-stats-form"></div>
                    <button id="submit-all-stats" class="btn-primary">Submit All Stats</button>
                </div>
            </div>

            <div id="game-history" class="tab-content">
                <h2>Game History</h2>
                <div id="games-list"></div>
            </div>
        </section>

        <!-- Section 2: Player Profiles -->
        <section id="profiles" class="section">
            <div class="section-header">
                <h2>Player Profiles</h2>
                <div class="year-filter">
                    <label>Year:</label>
                    <select id="year-filter-profiles">
                    </select>
                </div>
            </div>
            <div class="profile-controls">
                <button id="add-player-btn" class="btn-primary">Add New Player</button>
            </div>

            <div id="players-list" class="players-list"></div>

            <div id="player-profile-modal" class="modal">
                <div class="modal-content profile-modal-content">
                    <span class="close" onclick="database.closeProfileModal()">&times;</span>
                    <div id="profile-modal-body"></div>
                </div>
            </div>

            <div id="add-player-form" class="modal">
                <div class="modal-content">
                    <span class="close" id="close-add-player">&times;</span>
                    <h3>Add New Player</h3>
                    <form id="player-form">
                        <div class="form-group">
                            <label>First Name:</label>
                            <input type="text" id="first-name" required>
                        </div>
                        <div class="form-group">
                            <label>Last Name:</label>
                            <input type="text" id="last-name" required>
                        </div>
                        <div class="form-group">
                            <label>Position:</label>
                            <input type="text" id="position">
                        </div>
                        <div class="form-group">
                            <label>Height (ft'in"):</label>
                            <input type="text" id="height" placeholder="e.g., 5'10&quot;">
                        </div>
                        <div class="form-group">
                            <label>Weight (lbs):</label>
                            <input type="number" id="weight">
                        </div>
                        <div class="form-group">
                            <label>Birthday:</label>
                            <input type="date" id="birthday">
                        </div>
                        <div class="form-group">
                            <label>Hobbies:</label>
                            <textarea id="hobbies"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Headshot:</label>
                            <input type="file" id="headshot" accept="image/*">
                        </div>
                        <button type="submit" class="btn-primary">Add Player</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section">
            <h2>Point Values Configuration</h2>
            <div class="settings-container">
                <div class="form-group">
                    <label>Win Points:</label>
                    <input type="number" id="points-win" value="3" step="0.1">
                </div>
                <div class="form-group">
                    <label>Draw Points:</label>
                    <input type="number" id="points-draw" value="1" step="0.1">
                </div>
                <div class="form-group">
                    <label>Loss Points:</label>
                    <input type="number" id="points-loss" value="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Clean Sheet Points:</label>
                    <input type="number" id="points-clean-sheet" value="1" step="0.1">
                </div>
                <div class="form-group">
                    <label>Goal Points (per goal):</label>
                    <input type="number" id="points-goal" value="1" step="0.1">
                </div>
                <div class="form-group">
                    <label>Captain Win Points:</label>
                    <input type="number" id="points-captain-win" value="2" step="0.1">
                </div>
                <div class="form-group">
                    <label>Captain Loss Points:</label>
                    <input type="number" id="points-captain-loss" value="-1" step="0.1">
                </div>
                <button id="save-settings" class="btn-primary">Save Settings</button>
                <button id="admin-settings-btn" class="btn-secondary" onclick="database.openAdminSettings()" style="margin-top: 15px;">
                    Admin Settings (Manage Access)
                </button>
            </div>
        </section>
    </main>

    <div id="video-player-modal" class="modal">
        <div class="modal-content video-modal-content">
            <span class="close" id="close-video-player">&times;</span>
            <video id="video-player" controls></video>
        </div>
    </div>

    <script type="module">
        // Show loading indicator
        const loadingEl = document.getElementById('firebase-loading');
        loadingEl.style.display = 'flex';

        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB_Wa0KwcGyKPDvycYwyWCS4OKaCImejcw",
            authDomain: "football-stats-cf534.firebaseapp.com",
            projectId: "football-stats-cf534",
            storageBucket: "football-stats-cf534.firebasestorage.app",
            messagingSenderId: "876750360073",
            appId: "1:876750360073:web:f75c6803743bd026e8f2d8",
            measurementId: "G-E3W8VZEJ7Q"
        };

        try {
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            // Make Firebase available globally
            window.firebaseDb = db;
            window.firebaseModules = {
                collection,
                doc,
                setDoc,
                getDoc,
                getDocs,
                deleteDoc,
                onSnapshot,
                query,
                orderBy
            };

            // Signal that Firebase is ready
            window.firebaseReady = true;
            window.dispatchEvent(new Event('firebaseReady'));
            
            console.log('‚úÖ Firebase initialized successfully!');
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
            alert('Failed to connect to Firebase. Please check your configuration and internet connection.');
        } finally {
            // Hide loading indicator
            loadingEl.style.display = 'none';
        }
    </script>
    <script src="app.js"></script>
</body>
</html>

